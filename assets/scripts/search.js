/*!
 * mapache v4.0.1-calnus-2.0
 * Copyright 2025 GodoFredoNinja <hello@godofredo.ninja> (https://github.com/godofredoninja/mapache)
 * Licensed under gpl-3.0
 */!function s(r,n,o){function h(e,t){if(!n[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(a)return a(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=n[e]={exports:{}},r[e][0].call(i.exports,function(t){return h(r[e][1][t]||t)},i,i.exports,s,r,n,o)}return n[e].exports}for(var a="function"==typeof require&&require,t=0;t<o.length;t++)h(o[t]);return h}({1:[function(t,e,i){e.exports=function(t){return t&&t.__esModule?t:{default:t}},e.exports.__esModule=!0,e.exports.default=e.exports},{}],2:[function(t,e,i){{var s="FlexSearch",r=function l(c){function f(t,e){var i=e?e.id:t&&t.id;this.id=i||0===i?i:r++,this.init(t,e),s(this,"index",function(){return this.a?Object.keys(this.a.index[this.a.keys[0]].c):Object.keys(this.c)}),s(this,"length",function(){return this.index.length})}function u(t,e,i,s){return this.u!==this.g&&(this.o=this.o.concat(i),this.u++,s&&this.o.length>=s&&(this.u=this.g),this.u===this.g)&&(this.cache&&this.j.set(e,this.o),this.F)&&this.F(this.o),this}function k(i,s){var r=i.length,n=j(s),o=[];for(let t=0,e=0;t<r;t++){var h=i[t];(n&&s(h)||!n&&!s[h])&&(o[e++]=h)}return o}function S(t,e,i,s,r,n,o,h,a,l){i=I(i,o?0:r,h,n,e,a,l);let c;if(h&&(h=i.page,c=i.next,i=i.result),o)e=this.where(o,null,r,i);else{for(e=i,i=this.l,r=e.length,n=Array(r),o=0;o<r;o++)n[o]=i[e[o]];e=n}return i=e,s&&(j(s)||(s=1<(q=s.split(":")).length?g:(q=q[0],d)),i.sort(s)),i=D(h,c,i),this.cache&&this.j.set(t,i),i}function s(t,e,i){Object.defineProperty(t,e,{get:i})}function b(t){return new RegExp(t,"g")}function x(e,i){for(let t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e}function w(t,e,i,s,r,n,o,h){return e[i]||(o<=(e[i]=r=r?(h-(o||h/1.5))*n+(o||h/1.5)*r:n)&&((t=(t=t[h-(r+.5>>0)])[i]||(t[i]=[]))[t.length]=s),r)}function h(i,s){if(i){var r=Object.keys(i);for(let t=0,e=r.length;t<e;t++){var n=r[t],o=i[n];if(o)for(let t=0,e=o.length;t<e;t++){if(o[t]===s){1===e?delete i[n]:o.splice(t,1);break}_(o[t])&&h(o[t],s)}}}}function O(e){let i="",s="";var r="";for(let t=0;t<e.length;t++){var n=e[t];n===s||t&&"h"===n&&(r="a"===r||"e"===r||"i"===r||"o"===r||"u"===r||"y"===r,"a"!==s&&"e"!==s&&"i"!==s&&"o"!==s&&"u"!==s&&"y"!==s||!r)&&" "!==s||(i+=n),r=t===e.length-1?"":e[t+1],s=n}return i}function E(t,e){return(t=t.length-e.length)<0?1:t?-1:0}function d(t,e){return(t=t[q])<(e=e[q])?-1:e<t?1:0}function g(e,i){var s=q.length;for(let t=0;t<s;t++)e=e[q[t]],i=i[q[t]];return e<i?-1:i<e?1:0}function D(t,e,i){return t?{page:t,next:e?""+e:null,result:i}:i}function I(c,f,u,d,g,p,m){let v,y=[];var b=!0===u?(u="0",""):u&&u.split(":"),x=c.length;if(1<x){var w=P(),k=[];let t,e;var S=0;let i;var O=!0;let s,r=0,n,o,h,a;if(b=b&&(2===b.length?(h=b,!1):a=parseInt(b[0],10)),m){for(t=P();S<x;S++)if("not"===g[S])for(e=c[S],i=e.length,L=0;L<i;L++)t["@"+e[L]]=1;else o=S+1;if(A(o))return D(u,v,y);S=0}else n=F(g)&&g;let l;for(;S<x;S++){var E=S===(o||x)-1;if(!n||!S)if((L=n||g&&g[S])&&"and"!==L){if("or"!==L)continue;l=!1}else l=p=!0;if(e=c[S],i=e.length){if(O){if(!s){s=e;continue}for(var I=s.length,L=0;L<I;L++){var j="@"+(O=s[L]);m&&t[j]||(w[j]=1,p)||(y[r++]=O)}s=null,O=!1}for(j=!1,L=0;L<i;L++){var _="@"+(I=e[L]),C=p?w[_]||0:S;if(!(!C&&!d||m&&t[_]||!p&&w[_]))if(C===S){if(E){if((!a||--a<r)&&(y[r++]=I,f)&&r===f)return D(u,r+(b||0),y)}else w[_]=S+1;j=!0}else d&&((_=k[C]||(k[C]=[]))[_.length]=I)}if(l&&!j&&!d)break}else if(l&&!d)return D(u,v,e)}if(s)if(S=s.length,m)for(L=b?parseInt(b,10):0;L<S;L++)c=s[L],t["@"+c]||(y[r++]=c);else y=s;if(d)for(r=y.length,L=h?(S=parseInt(h[0],10)+1,parseInt(h[1],10)+1):(S=k.length,0);S--;)if(I=k[S]){for(i=I.length;L<i;L++)if(d=I[L],(!m||!t["@"+d])&&(y[r++]=d,f)&&r===f)return D(u,S+":"+L,y);L=0}}else!x||g&&"not"===g[0]||(y=c[0],b=b&&parseInt(b[0],10));return f&&(m=y.length,b=(b=b&&m<b?0:b)||0,(v=b+f)<m?y=y.slice(b,v):(v=0,b&&(y=y.slice(b)))),D(u,v,y)}function F(t){return"string"==typeof t}function L(t){return t.constructor===Array}function j(t){return"function"==typeof t}function _(t){return"object"==typeof t}function A(t){return void 0===t}function C(e){var i=Array(e);for(let t=0;t<e;t++)i[t]=P();return i}function P(){return Object.create(null)}function p(){let i,s;self.onmessage=function(t){var e;(t=t.data)&&(t.search?(e=s.search(t.content,t.threshold?{limit:t.limit,threshold:t.threshold,where:t.where}:t.limit),self.postMessage({id:i,content:t.content,limit:t.limit,result:e})):t.add?s.add(t.id,t.content):t.update?s.update(t.id,t.content):t.remove?s.remove(t.id):t.clear?s.clear():t.info?((t=s.info()).worker=i,console.log(t)):t.register&&(i=t.id,t.options.cache=!1,t.options.async=!1,t.options.worker=!1,s=new(s=new Function(t.register.substring(t.register.indexOf("{")+1,t.register.lastIndexOf("}")))())(t.options)))}}let m={encode:"icase",f:"forward",split:/\W+/,cache:!1,async:!1,g:!1,D:!1,a:!1,b:9,threshold:0,depth:0},v={memory:{encode:"extra",f:"strict",threshold:0,b:1},speed:{encode:"icase",f:"strict",threshold:1,b:3,depth:2},match:{encode:"extra",f:"full",threshold:1,b:3},score:{encode:"extra",f:"strict",threshold:1,b:9,depth:4},balance:{encode:"balance",f:"strict",threshold:0,b:3,depth:3},fast:{encode:"icase",f:"strict",threshold:8,b:9,depth:1}},i=[],r=0,y={},M={};f.create=function(t,e){return new f(t,e)},f.registerMatcher=function(t){for(var e in t)t.hasOwnProperty(e)&&i.push(b(e),t[e]);return this},f.registerEncoder=function(t,e){return B[t]=e.bind(B),this},f.registerLanguage=function(t,e){return y[t]=e.filter,M[t]=e.stemmer,this},f.encode=function(t,e){return B[t](e)},f.prototype.init=function(e,i){var t,s;if(this.v=[],i?(t=i.preset,e=i):t=(e=e||m).preset,i={},F(e)?(i=v[e],e={}):t&&(i=v[t]),t=e.worker)if("undefined"==typeof Worker)e.worker=!1,this.m=null;else{var r=parseInt(t,10)||4;this.C=-1,this.u=0,this.o=[],this.F=null,this.m=Array(r);for(var n=0;n<r;n++)this.m[n]=((t,e,i,s)=>{t=c("flexsearch","id"+t,p,function(t){(t=t.data)&&t.result&&s(t.id,t.content,t.result,t.limit,t.where,t.cursor,t.suggest)},e);var r=l.toString();return i.id=e,t.postMessage({register:r,options:i,id:e}),t})(this.id,n,e,u.bind(this))}if(this.f=e.tokenize||i.f||this.f||m.f,this.split=A(t=e.split)?this.split||m.split:F(t)?b(t):t,this.D=e.rtl||this.D||m.D,this.async="undefined"==typeof Promise||A(t=e.async)?this.async||m.async:t,this.g=A(t=e.worker)?this.g||m.g:t,this.threshold=A(t=e.threshold)?i.threshold||this.threshold||m.threshold:t,this.b=A(t=e.resolution)?t=i.b||this.b||m.b:t,t<=this.threshold&&(this.b=this.threshold+1),this.depth="strict"!==this.f||A(t=e.depth)?i.depth||this.depth||m.depth:t,this.w=(t=A(t=e.encode)?i.encode||m.encode:t)&&B[t]&&B[t].bind(B)||(j(t)?t:this.w||!1),(t=e.matcher)&&this.addMatcher(t),t=(i=e.lang)||e.filter){if(L(t=F(t)?y[t]:t)){for(var r=this.w,n=P(),o=0;o<t.length;o++){var h=r?r(t[o]):t[o];n[h]=1}t=n}this.filter=t}if(t=i||e.stemmer){for(s in i=F(t)?M[t]:t,r=this.w,n=[],i)i.hasOwnProperty(s)&&(o=r?r(s):s,n.push(b(o+"($|\\W)"),r?r(i[s]):i[s]));this.stemmer=s=n}if(this.a=n=(t=e.doc)?function t(e){var i,s,r=P();for(i in e)e.hasOwnProperty(i)&&(L(s=e[i])?r[i]=s.slice(0):r[i]=_(s)?t(s):s);return r}(t):this.a||m.a,this.i=C(this.b-(this.threshold||0)),this.h=P(),this.c=P(),n){if(this.l=P(),e.doc=null,s=n.index={},i=n.keys=[],r=n.field,o=n.tag,h=n.store,L(n.id)||(n.id=n.id.split(":")),h){var a=P();if(F(h))a[h]=1;else if(L(h))for(let t=0;t<h.length;t++)a[h[t]]=1;else _(h)&&(a=h);n.store=a}if(o){if(this.G=P(),h=P(),r)if(F(r))h[r]=e;else if(L(r))for(a=0;a<r.length;a++)h[r[a]]=e;else _(r)&&(h=r);for(L(o)||(n.tag=o=[o]),r=0;r<o.length;r++)this.G[o[r]]=P();this.I=o,r=h}if(r){let t;for(L(r)||(_(r)?(t=r,n.field=r=Object.keys(r)):n.field=r=[r]),n=0;n<r.length;n++)L(o=r[n])||(t&&(e=t[o]),i[n]=o,r[n]=o.split(":")),s[o]=new f(e)}e.doc=t}return this.B=!0,this.j=!!(this.cache=t=A(t=e.cache)?this.cache||m.cache:t)&&new U(t),this},f.prototype.encode=function(t){return t=t&&(i.length&&(t=x(t,i)),this.v.length&&(t=x(t,this.v)),this.w&&(t=this.w(t)),this.stemmer)?x(t,this.stemmer):t},f.prototype.addMatcher=function(t){var e,i=this.v;for(e in t)t.hasOwnProperty(e)&&i.push(b(e),t[e]);return this},f.prototype.add=function(i,s,r,n,e){if(this.a&&_(i))return this.A("add",i,s);if(s&&F(s)&&(i||0===i)){var t="@"+i;if(this.c[t]&&!n)return this.update(i,s);if(this.g)return++this.C>=this.m.length&&(this.C=0),this.m[this.C].postMessage({add:!0,id:i,content:s}),this.c[t]=""+this.C,r&&r(),this;if(!e){if(this.async&&"function"!=typeof importScripts){let e=this;return(t=new Promise(function(t){setTimeout(function(){e.add(i,s,null,n,!0),e=null,t()})}),r)?(t.then(r),this):t}if(r)return this.add(i,s,null,n,!0),r(),this}if(!(s=this.encode(s)).length)return this;e=j(r=this.f)?r(s):s.split(this.split),this.filter&&(e=k(e,this.filter));var o=P(),h=(o._ctx=P(),e.length),a=this.threshold,l=this.depth,c=this.b,f=this.i,u=this.D;for(let t=0;t<h;t++){var d=e[t];if(d){var g=d.length,p=(u?t+1:h-t)/h,m="";switch(r){case"reverse":case"both":for(var v=g;--v;)w(f,o,m=d[v]+m,i,u?1:(g-v)/g,p,a,c-1);m="";case"forward":for(v=0;v<g;v++)w(f,o,m+=d[v],i,u?(v+1)/g:1,p,a,c-1);break;case"full":for(v=0;v<g;v++){var y=(u?v+1:g-v)/g;for(let t=g;t>v;t--)w(f,o,m=d.substring(v,t),i,y,p,a,c-1)}break;default:if(g=w(f,o,d,i,1,p,a,c-1),l&&1<h&&a<=g)for(g=o._ctx[d]||(o._ctx[d]=P()),d=this.h[d]||(this.h[d]=C(c-(a||0))),(p=t-l)<0&&(p=0),h<(m=t+l+1)&&(m=h);p<m;p++)p!==t&&w(d,g,e[p],i,0,c-(p<t?t-p:p-t),a,c-1)}}}this.c[t]=1,this.B=!1}return this},f.prototype.A=function(i,s,r){if(L(s)){var n=s.length;if(n--){for(var t=0;t<n;t++)this.A(i,s[t]);return this.A(i,s[n],r)}}else{for(var e,o=this.a.index,h=this.a.keys,a=this.a.tag,t=this.a.store,l=this.a.id,n=s,c=0;c<l.length;c++)n=n[l[c]];if("remove"===i&&(delete this.l[n],l=h.length,l--)){for(s=0;s<l;s++)o[h[s]].remove(n);return o[h[l]].remove(n,r)}if(a){for(e=0;e<a.length;e++){for(var f=a[e],u=s,l=f.split(":"),c=0;c<l.length;c++)u=u[l[c]];u="@"+u}e=(e=this.G[f])[u]||(e[u]=[])}for(let t=0,e=(l=this.a.field).length;t<e;t++){for(f=l[t],a=s,u=0;u<f.length;u++)a=a[f[u]];f=o[h[t]],u="add"===i?f.add:f.update,t===e-1?u.call(f,n,a,r):u.call(f,n,a)}if(t){for(r=Object.keys(t),i=P(),o=0;o<r.length;o++)if(t[h=r[o]]){h=h.split(":");let t,e;for(l=0;l<h.length;l++)a=h[l],t=(t||s)[a],e=(e||i)[a]=t}s=i}e&&(e[e.length]=s),this.l[n]=s}return this},f.prototype.update=function(t,e,i){return this.a&&_(t)?this.A("update",t,e):(this.c["@"+t]&&F(e)&&(this.remove(t),this.add(t,e,i,!0)),this)},f.prototype.remove=function(i,t,e){if(this.a&&_(i))return this.A("remove",i,t);var s="@"+i;if(this.c[s]){if(this.g)return this.m[this.c[s]].postMessage({remove:!0,id:i}),delete this.c[s],t&&t(),this;if(!e){if(this.async&&"function"!=typeof importScripts){let e=this;return(s=new Promise(function(t){setTimeout(function(){e.remove(i,null,!0),e=null,t()})}),t)?(s.then(t),this):s}if(t)return this.remove(i,null,!0),t(),this}for(t=0;t<this.b-(this.threshold||0);t++)h(this.i[t],i);this.depth&&h(this.h,i),delete this.c[s],this.B=!1}return this};let q,t=(f.prototype.search=function(h,a,t,l){if(_(a)){if(L(a))for(var c=0;c<a.length;c++)a[c].query=h;else a.query=h;h=a,a=1e3}else a&&j(a)?(t=a,a=1e3):a||0===a||(a=1e3);if(!this.g){var f,u,d,g=[],i=h;if(_(h)&&!L(h)&&(t||(t=h.callback)&&(i.callback=null),f=h.sort,u=h.page,a=h.limit,w=h.threshold,d=h.suggest,h=h.query),this.a){w=this.a.index;let s=i.where;var p=i.bool||"or",m=i.field;let r=p,n,o;if(m)L(m)||(m=[m]);else if(L(i)){var e=i,m=[];r=[];for(var v=0;v<i.length;v++)c=(l=i[v]).bool||p,m[v]=l.field,"not"===(r[v]=c)?n=!0:"and"===c&&(o=!0)}else m=this.a.keys;for(p=m.length,v=0;v<p;v++)e&&(i=e[v]),u&&!F(i)&&(i.page=null,i.limit=0),g[v]=w[m[v]].search(i,0);if(t)return t(S.call(this,h,r,g,f,a,d,s,u,o,n));if(this.async){let i=this;return new Promise(function(e){Promise.all(g).then(function(t){e(S.call(i,h,r,t,f,a,d,s,u,o,n))})})}return S.call(this,h,r,g,f,a,d,s,u,o,n)}if(w=w||this.threshold||0,!l){if(this.async&&"function"!=typeof importScripts){let e=this;return(w=new Promise(function(t){setTimeout(function(){t(e.search(i,a,null,!0)),e=null})}),t)?(w.then(t),this):w}if(t)return t(this.search(i,a,null,!0)),this}if(h&&F(h)){if(i=h,this.cache)if(this.B){if(t=this.j.get(h))return t}else this.j.clear(),this.B=!0;if((i=this.encode(i)).length){t=j(t=this.f)?t(i):i.split(this.split),e=(t=this.filter?k(t,this.filter):t).length,l=!0;var c=[],r=P(),n=0;if(1<e&&(this.depth&&"strict"===this.f?p=!0:t.sort(E)),!p||(v=this.h))for(var o=this.b;n<e;n++){let s=t[n];if(s){if(p){if(!m)if(v[s])r[m=s]=1;else if(!d)return g;if(d&&n===e-1&&!c.length)p=!1,r[s=m||s]=0;else if(!m)continue}if(!r[s]){var y=[];let e=!1,i=0;var b,x=p?v[m]:this.i;if(x)for(let t=0;t<o-w;t++)(b=x[t]&&x[t][s])&&(y[i++]=b,e=!0);if(e)m=s,c[c.length]=1<i?y.concat.apply([],y):y[0];else if(!d){l=!1;break}r[s]=1}}}else l=!1;l&&(g=I(c,a,u,d)),this.cache&&this.j.set(h,g)}}return g}this.F=t,this.u=0,this.o=[];for(var w=0;w<this.g;w++)this.m[w].postMessage({search:!0,limit:a,content:h})},f.prototype.find=function(t,e){return this.where(t,e,1)[0]||null},f.prototype.where=function(s,r,t,e){var n,o=this.l,h=[];let a=0,l,c;if(_(s)){t=t||r;var f=Object.keys(s),u=f.length;if(l=!1,1===u&&"id"===f[0])return[o[s.id]];if((n=this.I)&&!e)for(var i=0;i<n.length;i++){var d=n[i],g=s[d];if(!A(g)){if(c=this.G[d]["@"+g],0==--u)return c;f.splice(f.indexOf(d),1),delete s[d];break}}for(n=Array(u),i=0;i<u;i++)n[i]=f[i].split(":")}else{if(j(s)){for(t=(r=e||Object.keys(o)).length,f=0;f<t;f++)s(u=o[r[f]])&&(h[a++]=u);return h}if(A(r))return[o[s]];if("id"===s)return[o[r]];f=[s],u=1,n=[s.split(":")],l=!0}for(i=(e=c||e||Object.keys(o)).length,d=0;d<i;d++){g=c?e[d]:o[e[d]];let i=!0;for(let t=0;t<u;t++){l||(r=s[f[t]]);var p=n[t],m=p.length;let e=g;if(1<m)for(let t=0;t<m;t++)e=e[p[t]];else e=e[p[0]];if(e!==r){i=!1;break}}if(i&&(h[a++]=g,t)&&a===t)break}return h},f.prototype.info=function(){if(!this.g)return{id:this.id,items:this.length,cache:!(!this.cache||!this.cache.s)&&this.cache.s.length,matcher:i.length+(this.v?this.v.length:0),worker:this.g,threshold:this.threshold,depth:this.depth,resolution:this.b,contextual:this.depth&&"strict"===this.f};for(let t=0;t<this.g;t++)this.m[t].postMessage({info:!0,id:this.id})},f.prototype.clear=function(){return this.destroy().init()},f.prototype.destroy=function(){if(this.cache&&(this.j.clear(),this.j=null),this.i=this.h=this.c=null,this.a){var e=this.a.keys;for(let t=0;t<e.length;t++)this.a.index[e[t]].destroy();this.a=this.l=null}return this},f.prototype.export=function(e){var t=!e||A(e.serialize)||e.serialize;if(this.a){var i=!e||A(e.doc)||e.doc,s=!e||A(e.index)||e.index;e=[];let t=0;if(s)for(s=this.a.keys;t<s.length;t++){var r=this.a.index[s[t]];e[t]=[r.i,r.h,Object.keys(r.c)]}i&&(e[t]=this.l)}else e=[this.i,this.h,Object.keys(this.c)];return e=t?JSON.stringify(e):e},f.prototype.import=function(t,e){e&&!A(e.serialize)&&!e.serialize||(t=JSON.parse(t));var i=P();if(this.a){var s=!e||A(e.doc)||e.doc,r=0;if(!e||A(e.index)||e.index){for(var n=(e=this.a.keys).length,o=t[0][2];r<o.length;r++)i[o[r]]=1;for(r=0;r<n;r++){var o=this.a.index[e[r]],h=t[r];h&&(o.i=h[0],o.h=h[1],o.c=i)}}s&&(this.l=_(s)?s:t[r])}else{for(s=t[2],r=0;r<s.length;r++)i[s[r]]=1;this.i=t[0],this.h=t[1],this.c=i}},(()=>{let t=b("\\s+"),e=b("[^a-z0-9 ]"),i=[b("[-/]")," ",e,"",t," "];return function(t){return O(x(t.toLowerCase(),i))}})()),B={icase:function(t){return t.toLowerCase()},simple:(()=>{let t=b("\\s+"),e=b("[^a-z0-9 ]"),i=b("[-/]"),s=b("[àáâãäå]"),r=b("[èéêë]"),n=b("[ìíîï]"),o=b("[òóôõöő]"),h=b("[ùúûüű]"),a=b("[ýŷÿ]"),l=b("ñ"),c=b("[çc]"),f=b("ß"),u=b(" & "),d=[s,"a",r,"e",n,"i",o,"o",h,"u",a,"y",l,"n",c,"k",f,"s",u," and ",i," ",e,"",t," "];return function(t){return" "===(t=x(t.toLowerCase(),d))?"":t}})(),advanced:(()=>{let t=b("ae"),e=b("ai"),i=b("ay"),s=b("ey"),r=b("oe"),n=b("ue"),o=b("ie"),h=b("sz"),a=b("zs"),l=b("ck"),c=b("cc"),f=b("sh"),u=b("th"),d=b("dt"),g=b("ph"),p=b("pf"),m=b("ou"),v=b("uo"),y=[t,"a",e,"ei",i,"ei",s,"ei",r,"o",n,"u",o,"i",h,"s",a,"s",f,"s",l,"k",c,"k",u,"t",d,"t",g,"f",p,"f",m,"o",v,"u"];return function(t,e){return t&&(2<(t=this.simple(t)).length&&(t=x(t,y)),e||1<t.length&&(t=O(t))),t}})(),extra:(()=>{let t=b("p"),e=b("z"),i=b("[cgq]"),s=b("n"),r=b("d"),n=b("[vw]"),o=b("[aeiouy]"),h=[t,"b",e,"s",i,"k",s,"m",r,"t",n,"f",o,""];return function(e){if(e&&1<(e=this.advanced(e,!0)).length){e=e.split(" ");for(let t=0;t<e.length;t++){var i=e[t];1<i.length&&(e[t]=i[0]+x(i.substring(1),h))}e=O(e=e.join(" "))}return e}})(),balance:t},U=(e.prototype.clear=function(){this.cache=P(),this.count=P(),this.index=P(),this.s=[]},e.prototype.set=function(e,i){if(this.H&&A(this.cache[e])){let t=this.s.length;var s;t===this.H&&(t--,s=this.s[t],delete this.cache[s],delete this.count[s],delete this.index[s]),this.index[e]=t,this.s[t]=e,this.count[e]=-1,this.cache[e]=i,this.get(e)}else this.cache[e]=i},e.prototype.get=function(e){var t=this.cache[e];if(this.H&&t){var i=++this.count[e],s=this.index;let t=s[e];if(0<t){for(var r=this.s,n=t;this.count[r[--t]]<=i&&-1!==t;);if(++t!==n){for(i=n;i>t;i--)n=r[i-1],s[r[i]=n]=i;s[r[t]=e]=t}}}return t},e);function e(t){this.clear(),this.H=!0!==t&&t}return f}((()=>{let n={},o="undefined"!=typeof Blob&&"undefined"!=typeof URL&&URL.createObjectURL;return function(t,e,i,s,r){return i=o?URL.createObjectURL(new Blob(["("+i.toString()+")()"],{type:"text/javascript"})):t+".min.js",t+="-"+e,n[t]||(n[t]=[]),n[t][r]=new Worker(i),n[t][r].onmessage=s,n[t][r]}})()),n=this;let t;(t=n.define)&&t.amd?t([],function(){return r}):(t=n.modules)?t[s.toLowerCase()]=r:"object"==typeof i?e.exports=r:n[s]=r}},{}],3:[function(t,e,i){var s=t("@babel/runtime/helpers/interopRequireDefault"),r=(Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0,s(t("flexsearch")));i.default=class{constructor(t){this.config={url:window.location.origin,key:"",version:"v4",loadOn:"focus",searchOn:"keyup",limit:10,inputId:["search-bar"],outputId:["search-results"],outputChildsType:"li",postsFields:["title","url","published_at"],postsExtraFields:[],postsFormats:[],indexedFields:["title"],template:function(t){},emptyTemplate:function(){},customProcessing:function(t){return t.tags&&(t.string_tags=t.tags.map(t=>t.name).join(" ").toLowerCase()),t},date:{locale:document.documentElement.lang||"en-US",options:{year:"numeric",month:"short",day:"numeric"}},cacheMaxAge:1800,onFetchStart:function(){},onFetchEnd:function(t){},onIndexBuildStart:function(){},onIndexBuildEnd:function(t){},onSearchStart:function(){},onSearchEnd:function(t){},indexOptions:{},searchOptions:{},debug:!1},this.dataLoaded=!1,this.postsCount=0,this.storage=this.getLocalStorageOption(),this.initConfig(t),this.triggerDataLoad()}initConfig(t){for(var[e,i]of Object.entries(t))this.config[e]=i;Array.isArray(this.config.inputId)||(this.config.inputId=[this.config.inputId]),Array.isArray(this.config.outputId)||(this.config.outputId=[this.config.outputId]),this.config.searchOptions.limit=this.config.limit,this.originalPostsFields=this.config.postsFields,this.config.postsFields.includes("updated_at")||this.config.postsFields.push("updated_at"),this.config.inputId&&0<this.config.inputId.length&&(this.searchBarEls=[],this.config.inputId.forEach(t=>{var e=document.getElementById(t);e?(this.searchBarEls.push(e),this.addSearchListeners(e)):this.error(`Enable to find the input element #${t}, please check your configuration`)})),this.config.outputId&&0<this.config.outputId.length&&(this.searchResultEls=[],this.config.outputId.forEach(t=>{var e=document.getElementById(t);e?this.searchResultEls.push(e):this.error(`Enable to find the output element #${t}, please check your configuration`)})),this.index=this.getNewSearchIndex()}addSearchListeners(e){var t=e.closest("form");switch(t&&t.addEventListener("submit",t=>{t.preventDefault()}),this.config.searchOn){case"keyup":e.addEventListener("keyup",()=>{var t=e.value.toLowerCase();this.search(t)});break;case"submit":t.addEventListener("submit",()=>{var t=e.value.toLowerCase();this.search(t)});break;case!1:case"none":break;default:this.error(`Unknown 'searchOn' option: '${this.config.searchOn}'`)}}triggerDataLoad(){switch(this.config.loadOn){case"focus":this.searchBarEls.forEach(t=>{t.addEventListener("focus",()=>{this.loadData()})});break;case"page":window.addEventListener("load",()=>{this.loadData()});break;case!1:case"none":break;default:this.error(`Unknown 'loadOn' option: '${this.config.loadOn}'`)}}loadData(){var t;this.dataLoaded||(this.storage?(t=this.storage.getItem("SearchinGhost_index"))?(this.log("Found an index stored locally, loads it"),this.config.onIndexBuildStart(),this.index.import(t),this.dataLoaded=!0,this.config.onIndexBuildEnd(this.index),this.validateCache()):(this.log("No already stored index found"),this.fetch()):(this.log("No local storage available, switch to degraded mode"),this.fetch()))}validateCache(){var t=this.storage.getItem("SearchinGhost_cache_info");if(t){let i=JSON.parse(t);var t=new Date(i.lastCacheCheck),t=Math.round((new Date-t)/1e3);t<this.config.cacheMaxAge?this.log(`Skip cache refreshing, updated less than ${this.config.cacheMaxAge}s ago (${t}s)`):(t=this.buildUrl({limit:1,fields:["updated_at"],order:"updated_at DESC"}),fetch(t).then(function(t){return t.json()}).then(t=>{var e=t.posts[0].updated_at,t=t.meta.pagination.total;e!==i.lastestPostUpdatedAt?(this.log("Posts update found, purge outdated local cache"),this.fetch()):t<i.totalPosts?(this.log("Deleted or unpublished posts found, purge outdated local cache"),this.fetch()):(this.log("Local cached data up to date"),i.lastCacheCheck=(new Date).toISOString(),this.storage.setItem("SearchinGhost_cache_info",JSON.stringify(i)))}).catch(t=>{console.error("Unable to fetch the latest post information to check cache state",t)}))}else this.log("No cache info local object found"),this.fetch()}fetch(){this.log("Fetching data from Ghost API"),this.config.onFetchStart();var t={limit:"all",fields:this.config.postsFields,order:"updated_at DESC"},t=(0<this.config.postsExtraFields.length&&(t.include=this.config.postsExtraFields),0<this.config.postsFormats.length&&(t.formats=this.config.postsFormats),this.buildUrl(t));fetch(t).then(function(t){return t.json()}).then(t=>{var e=t.posts;this.config.onFetchEnd(e),this.config.onIndexBuildStart(),this.index=this.getNewSearchIndex(),e.forEach(t=>{t=this.format(t);t&&this.index.add(t)}),this.dataLoaded=!0,this.config.onIndexBuildEnd(this.index),this.storage&&(e={lastCacheCheck:(new Date).toISOString(),lastestPostUpdatedAt:e[0].updated_at,totalPosts:t.meta.pagination.total},this.storage.setItem("SearchinGhost_index",this.index.export()),this.storage.setItem("SearchinGhost_cache_info",JSON.stringify(e))),this.log("Search index build complete")}).catch(t=>{this.error("Unable to fetch Ghost data.\n",t)})}format(t){return t.id=this.postsCount++,t.published_at=this.prettyDate(t.published_at),this.originalPostsFields.includes("updated_at")||delete t.updated_at,t.custom_excerpt&&(t.excerpt=t.custom_excerpt,delete t.custom_excerpt),t=this.config.customProcessing(t)}search(t){this.loadData(),this.config.onSearchStart();t=this.index.search(t,this.config.searchOptions);return this.searchResultEls&&0<this.searchResultEls.length&&this.display(t),this.config.onSearchEnd(t),t}display(t){this.searchResultEls.forEach(t=>{t.innerHTML=""}),t.length<1?this.insertTemplate(this.config.emptyTemplate()):t.forEach(t=>{this.insertTemplate(this.config.template(t))})}insertTemplate(i){i&&this.searchResultEls.forEach(t=>{var e;this.config.outputChildsType?((e=document.createElement(this.config.outputChildsType)).classList.add(t.id+"-item"),e.innerHTML=i,t.appendChild(e)):t.insertAdjacentHTML("beforeend",i)})}getNewSearchIndex(){var t,e,i={doc:{id:"id",field:this.config.indexedFields},encode:"simple",tokenize:"forward",threshold:0,resolution:4,depth:0};for([t,e]of Object.entries(this.config.indexOptions))i[t]=e;return new r.default(i)}buildUrl(t){let e=`${this.config.url}/ghost/api/${this.config.version}/content/posts/?key=`+this.config.key;for(var[i,s]of Object.entries(t))e+=`&${i}=`+s;return encodeURI(e)}prettyDate(t){return new Date(t).toLocaleDateString(this.config.date.locale,this.config.date.options)}getLocalStorageOption(){try{return window.localStorage.setItem("storage-availability-test",""),window.localStorage.removeItem("storage-availability-test"),window.localStorage}catch(t){}}log(t,e){this.config.debug&&(e?console.log(t,e):console.log(t))}error(t,e){e?console.error(t,e):console.error(t)}}},{"@babel/runtime/helpers/interopRequireDefault":1,flexsearch:2}],4:[function(f,t,e){f=f("@babel/runtime/helpers/interopRequireDefault")(f("./lib/searchinghost"));{var u=document;let t=u.body,e=u.querySelector(".js-search"),s=u.querySelector("#search-bar"),r=u.querySelector("#search-results"),n="is-active",o=0,i=(()=>{try{return window.localStorage.setItem("storage-mapache-test",""),window.localStorage.removeItem("storage-mapache-test"),window.localStorage}catch(t){}})(),h=t=>`<a class="block noWrapWithEllipsis px-4 py-2" href="${t.url}"><svg class="icon is-x-small mr-2"><use xlink:href="#icon-search"></use></svg> <span>${void 0===t.name?t.title:t.name}</span></a>`;var d={key:searchSettings.key,template:t=>h(t),onSearchEnd:function(t){o=t.length,g();t=JSON.parse(localStorage.getItem("mapache_tags"));""===s.value&&t&&a(t)}};function g(t){t=t||0;var e=r.querySelectorAll("li");e.length&&(e.forEach(t=>t.classList.remove(n)),e[t].classList.add(n))}function p(t){var e=t.keyCode;if(27===e)c();else if(13===e)s.blur(),(i=r.querySelector("li."+n))&&i.firstChild.click();else if(38===e||40===e){{var i=e;let t=0;e=r.querySelector("li."+n);e&&(t=[].slice.call(e.parentNode.children).indexOf(e)),s.blur(),38===i?t<=0?(s.focus(),t=0):--t:t>=o-1?t=0:t+=1,g(t)}t.preventDefault()}}let a=t=>{o=t.length,t.forEach(t=>{var e=u.createElement("li"),t=h(t);e.innerHTML=t,r.appendChild(e)}),g()};var m,v=u.querySelectorAll(".js-toggle-search");let l=!1,c=()=>{l=l?(e.classList.add("hidden"),t.removeEventListener("keydown",p),!1):(e.classList.remove("hidden"),t.addEventListener("keydown",p),s.focus(),!0)};v.forEach(t=>t.addEventListener("click",function(t){t.preventDefault(),c()})),v=(void 0===searchSettings.url?window.location.origin:searchSettings.url)+`/ghost/api/v4/content/tags/?key=${searchSettings.key}&filter=visibility:public&limit=10`,(m=localStorage.getItem("mapache_tags"))?a(JSON.parse(m)):(async t=>await(await fetch(t)).json())(v).then(t=>{if(a(t.tags),!i)return!1;localStorage.setItem("mapache_tags",JSON.stringify(t.tags))}).catch(t=>console.error(t)),new f.default(d)}},{"./lib/searchinghost":3,"@babel/runtime/helpers/interopRequireDefault":1}]},{},[4]);